# リファクタリングフェーズ

## 0. モード宣言
- 作業開始時に `[REFACTOR]` モードであることを明記し、対象となる改善候補を列挙する。
- 各候補は設計またはレビューで合意したものに限定する。新規アイデアが生じた場合は `OTHER TASK` として切り出す。

## 1. 準備
- シンプル実装ループで蓄積した残課題メモを読み、影響範囲・依存先・必要テストを整理する。
- 変更予定ファイル、想定リスク、検証計画を箇条書きでまとめてから着手する。
- use context7

## 2. リファクタリング

### 重要

- リファクタリングであるため、挙動を変更しないこと
- ただし、挙動を変更する恐れがあるという理由でリファクタリングをさぼらないこと

### やること

- 今回の修正について、あなたが判断をしリファクタリングを行う
- `vibes/tmp/{ブランチ名}/review.md` を読み、リファクタリングの内容が妥当であればリファクタリングを行う
- この段階で `vibes/tmp/{ブランチ名}/review.md` に指摘された項目について、すべて 対応完了/対応不要/別タスクにする のいずれかになっていること

## 3. rubocop

- 「コミット前チェック」 を実行する
   - これそのものはリファクタリングではないが、ほかに入れるところがないのでここに入れる

## 3. レポート
- 実施した改善を表形式または箇条書きで整理し、各項目の検証結果を添える。
- 未対応の改善案や追加で必要な設計があれば `OTHER TASK` としてまとめる。
- 人間レビューへ渡すための最終サマリーを作成し、変更点・テスト結果・残リスクを一目で分かるように書く。
